<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PoE 2 Infernalist Loop Calculator v1.1</title>
    <style>
        /* Added ramp calculator styling */
        .ramp-calculator {
            margin-top: 2rem;
            padding: 1rem;
            background: rgba(255, 170, 0, 0.05);
            border: 1px solid #FFAA0033;
            border-radius: 4px;
        }

        .warning { color: #FF4444; }
        .success { color: #44FF44; }
    </style>
</head>
<body>
    <div class="calculator">
        <!-- Previous inputs remain the same -->
        
        <!-- New Ramp Calculator Inputs -->
        <div class="ramp-calculator">
            <h3>Ramp Configuration</h3>
            <div class="input-group">
                <label>BI Energy per Trigger:</label>
                <input type="number" id="energyPerTrigger" value="220" step="1">
            </div>
            <div class="input-group">
                <label>BI Cooldown (seconds):</label>
                <input type="number" id="biCooldown" value="0.8" step="0.1">
            </div>
        </div>

        <button onclick="calculateLoop()">Calculate Loop Stability</button>
        
        <div class="result" id="result"></div>
    </div>

    <script>
        function calculateLoop() {
            // Previous calculations remain the same
            
            // New Ramp Calculations
            const energyPerTrigger = parseFloat(document.getElementById('energyPerTrigger').value) || 220;
            const biCooldown = parseFloat(document.getElementById('biCooldown').value) || 0.8;

            // Ramp simulation parameters
            let currentEnergy = buffedEnergy;
            let leftoverEnergy = currentEnergy % energyPerTrigger;
            let cycles = 0;
            let totalTime = 0;
            let safeCycles = 0;
            let energyHistory = [];

            while (cycles < 1000 && totalTime < 30) { // Limit to 30 seconds simulation
                const triggers = Math.floor(currentEnergy / energyPerTrigger);
                leftoverEnergy = currentEnergy % energyPerTrigger;
                
                // Energy from new overflow (simplified)
                currentEnergy = buffedEnergy + leftoverEnergy;
                
                // Time accounting (3 triggers per BI activation)
                totalTime += biCooldown * (triggers / 3);
                
                // Track energy buildup
                energyHistory.push({
                    cycle: cycles,
                    energy: currentEnergy.toFixed(2),
                    time: totalTime.toFixed(2),
                    triggers
                });

                // Check sustainability
                const currentDPS = selfDamage * (triggers / biCooldown);
                if (currentDPS > 10370) break; // Stop when exceeding flask regen
                
                cycles++;
                safeCycles = cycles;
            }

            // Display results
            resultDiv.innerHTML += `
                <h3>Ramp Analysis:</h3>
                <p>Initial Energy/Overflow: <strong>${buffedEnergy.toFixed(2)}</strong></p>
                <p>Leftover Energy/cycle: <strong>${leftoverEnergy.toFixed(2)}</strong></p>
                <p>Safe Duration: <strong>${totalTime.toFixed(2)}s</strong> (${safeCycles} cycles)</p>
                <p>Final Trigger Rate: <strong class="${totalTime < 30 ? 'warning' : 'success'}">
                    ${((safeCycles / totalTime) || 0).toFixed(2)} triggers/sec
                </strong></p>
            `;
        }
    </script>
</body>
</html>
